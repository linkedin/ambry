## Terminologies

HardwareLayout   - Has information about the nodes available in the cluster. disks for those nodes and their states
PartitionLayout  - Has information about the partitions and its replicas
Blobid           - BlobId of the blob/object which was generated by ambry on put


## Set up
To execute this tool, copy all the required jar files to a temp directory. Once you have all the required jar files,
you can execute the following commands from the same directory.


## DumpData
This tool is used to dump the data parsing the storage files.
 
#### Operations supported
* Dumping log file
* Dumping index file
* Dumping replicaToken
* Compare index entries to log contents

## BlobValidator
This tool is used to perform read operations for a blob directly from the server. 

#### Operations supported:
* Get blob(deserialize blob) for a given blob id for all its replicas
* Get blob(deserialize blob) for a given blob id for local replicas in a datacenter
* Get blob(deserialize blob) for a given blob id for the given replica

## AdminTool
This tool exposes some admin APIs to get more information for debugging purposes

#### Operations supported
* List replicas for a blobid

## Examples

### Dumping Index

#### Dump Index
```java
java -cp "*" com.github.ambry.tools.admin.DumpData --hardwareLayout [HardwareLayoutFile]
 --partitionLayout [PartitionLayoutFile] --typeOfFile index --fileToRead [indexFile]
```

#### Dump index filtering for a list of blobs
```java
java -cp "*" com.github.ambry.tools.admin.DumpData --hardwareLayout [HardwareLayoutFile] --partitionLayout [PartitionLayoutFile]
--typeOfFile index --fileToRead [indexFile] --listOfBlobs [blobid1,blobid2,blobid3]
```

### Dumping Log

#### Dump log file
```java
java -cp "*" com.github.ambry.tools.admin.DumpData --hardwareLayout [HardwareLayoutFile]
--partitionLayout [PartitionLayoutFile] --typeOfFile index --fileToRead [logFile]
```

#### Dump log ending at offset x
```java
java -cp "*" com.github.ambry.tools.admin.DumpData
--hardwareLayout [HardwareLayoutFile] --partitionLayout [PartitionLayoutFile] --typeOfFile index
--fileToRead [logFile] --endOffset x
```

#### Dump log starting at x offset and ending at y filtered with a set of blobs
```java
java -cp "*" com.github.ambry.tools.admin.DumpData
--hardwareLayout [HardwareLayoutFile] --partitionLayout [PartitionLayoutFile] --typeOfFile index
--fileToRead [logFile] --startOffset x --endOffset y --listOfBlobs [blobid1,blobid2,blobid3]
```

### Comparing index entries to log entries(or in other words, trying to read a log record based on index info for every entry in the index)
```java
java -cp "*" com.github.ambry.tools.admin.DumpData
--hardwareLayout [HardwareLayoutFile] --partitionLayout [PartitionLayoutFile] --fileToRead [indexFile]
--logFileToDump [logFile]
```


### BlobValidator

#### Get blob from all replicas
```java
java -cp "*" com.github.ambry.tools.admin.BlobValidator --hardwareLayout [HardwareLayoutFile]
--partitionLayout [PartitionLayoutFile] --typeOfOperation VALIDATE_BLOB_ON_ALL_REPLICAS --ambryBlobId [blobid]
```

#### Get blob from all replicas from a datecenter
```java
java -cp "*" com.github.ambry.tools.admin.BlobValidator --hardwareLayout [HardwareLayoutFile]
--partitionLayout [PartitionLayoutFile] --typeOfOperation VALIDATE_BLOB_ON_DATACENTER --fabric [fabric]
--ambryBlobId [blobid]
```

#### Get blob from a replica
```java
java -cp "*" com.github.ambry.tools.admin.BlobValidator --hardwareLayout [HardwareLayoutFile]
--partitionLayout [PartitionLayoutFile] --typeOfOperation VALIDATE_BLOB_ON_REPLICA --ambryBlobId [blobid]
--replicaHost [replicaHost] --replicaPort [replicaPort]
```

### AdminTool

#### List Replicas
```java
java -cp "*" com.github.ambry.tools.admin.AdminTool --hardwareLayout [HardwareLayoutFile]
--partitionLayout [PartitionLayoutFile] --typeOfOperation LIST_REPLICAS --ambryBlobId [blobid]
```

### ConsistencyCheckerTool

#### Check for consistency among replicas for a partition
```java
java -cp "*" com.github.ambry.tools.admin.ConsistencyCheckerTool --hardwareLayout [HardwareLayoutFile]
--partitionLayout [PartitionLayoutFile] --rootDirectoryForPartition [rootDirectory which contains replicas which in
turn contains all index files] --outFile [outFile]
```

Root Directory for Partition should contains N sub-directories pertaining to N replicas. Each sub-directory's name
should be the same as name of the replica. Each sub directory(replica) in turn should have all the index segments within it.
A sample structure of a root Directory:
rootDir:
  ela4-app8763.prod.linkedin.com
    0_index
    10264262199_index
    10821344563_index
  lva1-app6774.prod.linkedin.com
    0_index
    10267816698_index
    10892574781_index
  lva1-app6775.prod.linkedin.com
    0_index
    10266323380_index
    10888037904_index


